<div id="main">

<script type="text/javascript" charset="utf-8">
var oTable;
var giRedraw = false;
var asInitVals = new Array();

$(document).ready(function() {
	

	/*$('#mashups tbody tr').each( function() {
        var sTitle;
        var nTds = $('td', $('#mashups tbody tr'));
        var sBrowser = $(nTds[2]).text();
        var sGrade = $(nTds[2]).text();

            sTitle =  sBrowser+' will provide a first class (A) level of CSS support.';

        alert( sTitle )
    } );*/


    /* Init table */
	oTable = $('#mashups').dataTable({
		"bProcessing": true,
		"bJQueryUI": true,
        "bPaginate": true,
        "bLengthChange": true,
        "bFilter": true,
        "bSort": true,
        "bInfo": true,
        "bAutoWidth": true,
		"sAjaxDataProp": "mashups",
        "sAjaxSource": '?menu=overview&format=json',
        "fnInitComplete": function(oSettings, json) {
        	
        	
        	//var aoData = oTable.fnSettings().aoData;
        	//var aiPos = oTable.fnGetPosition();
        	//var nTd = aoData[ aiPos[0] ]._anHidden[ aiPos[1] ];
        	
        	
        	/* Add a click handler to the delete href */
        	$('#mashups a.delete').live('click', function (event) {
        	    event.preventDefault();
        	     
	        	/* Get the nodes from the table */
        	    var aTrs = oTable.fnGetNodes(); 
	        	
	     		/* Get current row from the table */
        	    var nRow = $(this).parents('tr')[0];
	     		/* Get content from current row */
        	    var aData=oTable.fnGetData(nRow);  
        	    //console.log(aData.id);
        	    
        	    /* Delete current row and redraw */
        	    oTable.fnDeleteRow( nRow );
              });
        	
        	/* Add a click handler to the show href */
        	$('#mashups a.show').live('click', function (event) {
        	    event.preventDefault();
        	    
	        	/* Get the nodes from the table */
        	    var aTrs = oTable.fnGetNodes(); 
	        	
	     		/* Get current row from the table */
        	    var nRow = $(this).parents('tr')[0];
	     		/* Get content from current row */
        	    var aData=oTable.fnGetData(nRow);  
        	    alert("Show ID: "+aData.id)
        	    //console.log(aData.id);
              });
        },
        "aoColumns": [
						  { 
							"mDataProp": null,
						  	"sDefaultContent": "<a class='show' href='javascript:void(0)'>Show</a>",
						  	"bSortable": false,
						  	"bSearchable": false,
						  },
						  { 
								"mDataProp": null,
							  	"sDefaultContent": "<a class='delete' href='javascript:void(0)'>Delete</a>",
							  	"bSortable": false,
							  	"bSearchable": false,
						  },
                          { "mDataProp": "id" },
                          { "mDataProp": "creator" },
                          { "mDataProp": "name" }
                      ]
    	
	} );
	
    	
	/* Add a double-click handler to the rows */
    $("#mashups tbody").dblclick(function(event) {
    	window.location = "?menu=mashup"; 
    });
	
	/* Add a click handler to the rows */
    $("#mashups tbody").click(function(event) {
        $(oTable.fnSettings().aoData).each(function (){
            $(this.nTr).removeClass('row_selected');
        });
        $(event.target.parentNode).addClass('row_selected');
    });
     
    /* Add a click handler for the selected row */
    $('#button_selected').click( function() {
        var anSelected = fnGetSelected( oTable );
        oTable.fnDeleteRow( anSelected[0] );
    } );
    
        
	$("tfoot input").keyup( function () {
        col = $("tfoot input").index(this);
        /* Do not run on first & second column */ 
        col = col + 2;
		
        /* Filter on the column (the index) of this element */
        oTable.fnFilter( this.value, col );
    } );
	
    /*
     * Support functions to provide a little bit of 'user friendlyness' to the textboxes in
     * the footer
     */
    $("tfoot input").each( function (i) {
        asInitVals[i] = this.value;
    } );
     
    $("tfoot input").focus( function () {
        if ( this.className == "search_init" )
        {
            this.className = "";
            this.value = "";
        }
    } );
     
    $("tfoot input").blur( function (i) {
        if ( this.value == "" )
        {
            this.className = "search_init";
            this.value = asInitVals[$("tfoot input").index(this)];
        }
    } );
    
} );

/* Get the rows which are currently selected */
function fnGetSelected( oTableLocal )
{
    var aReturn = new Array();
    var aTrs = oTableLocal.fnGetNodes();
     
    for ( var i=0 ; i<aTrs.length ; i++ )
    {
        if ( $(aTrs[i]).hasClass('row_selected') )
        {
            aReturn.push( aTrs[i] );
        }
    }
    return aReturn;
}

</script>
<h1>Mashup Overview</h1>

<table class="display" id="mashups">
	<thead>
		<tr>
			<th>Show</th>
			<th>Delete</th>
			<th>id</th>
			<th>creator</th>
			<th>name</th>
		</tr>
	</thead>
	<tbody>

	</tbody>
	<tfoot>
		<tr>
			<th></th>
			<th></th>
			<th><input type="text" name="search_id" value="Search id" class="search_init" /></th>
			<th><input type="text" name="search_creator" value="Search creators" class="search_init" /></th>
			<th><input type="text" name="search_name" value="Search names" class="search_init" /></th>
		</tr>
	</tfoot>
</table>


</div>